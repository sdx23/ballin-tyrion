<project xmlns:ivy="antlib:org.apache.ivy.ant" name="gutenberg-preprocessor" default="jar" basedir=".">
	<description>
		Builds hadoop map-reduce preprocessor for statistical data mining final project. Requires Apache Ant for building
		and Apache Ivy for dependency resolution.
	</description>
	
    <!-- global properties -->
    <property name="src" location="src" />
    <property name="tests" location="tests" />
    <property name="lib" location="lib" />
    <property name="build" location="build" />
    <property name="dist" location="dist" />
    <property name="bin" location="bin" /> <!-- generated by eclipse -->

	<target name="dependencies" description="--> retrieve dependencies with ivy">
        <ivy:configure />
        <ivy:retrieve />
    </target>
	
	<target name="init" depends="dependencies" description="---> init">
		<tstamp />
		<mkdir dir="${build}" />
	</target>
	
	<target name="compile" depends="init" description="---> compile">
		<javac srcdir="${src}" listfiles="true" destdir="${build}" deprecation="Yes" 
		 debug="true" debuglevel="lines,vars,source" includeantruntime="false">
            <classpath>
	            <fileset dir="lib/" includes="*.jar" />
            </classpath>
        </javac>
	</target>
	
    <!-- build executable jar file -->
    <target name="jar" depends="compile" description="--> create executable jar">                
        <copy todir="${dist}/lib">
            <fileset dir="${lib}">
                    <include name="**/*.jar" />
                    <exclude name="**/*-sources.jar" />
                    <exclude name="**/*-javadoc.jar" />
                    <exclude name="**/junit*.jar" />
            </fileset>
        </copy>

        <manifestclasspath property="manifest_cp" jarfile="${dist}/gutenberg-preprocessor.jar">
            <classpath>
                <fileset dir="${dist}/lib">
        	        <include name="**/*.jar" />
                </fileset>
            </classpath>
        </manifestclasspath>
                        
        <jar destfile ="${dist}/gutenberg-preprocessor.jar" basedir="${build}" includes="**/*.class">
            <manifest>
                <attribute name="Main-Class" value="is.hi.sdm.gutenberg.PreprocessorHelp" />
                <attribute name="Class-Path" value="${manifest_cp}" />
            </manifest>
        </jar>
        
        <chmod perm="+x" file="${dist}/gutenberg-preprocessor.jar" />
    </target>
</project>